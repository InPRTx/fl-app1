<!DOCTYPE html>
<html>
<head>
    <!--
      If you are serving your web app in a path other than the root, change the
      href value below to reflect the base path you are serving from.

      The path provided below has to start and end with a slash "/" in order for
      it to work correctly.

      For more details:
      * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

      This is a placeholder for base href that will be replaced by the value of
      the `--base-href` argument provided to `flutter build`.
    -->
    <base href="$FLUTTER_BASE_HREF">

    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta content="A new Flutter project." name="description">

    <!-- iOS meta tags & icons -->
    <meta content="yes" name="mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="fl_app1" name="apple-mobile-web-app-title">
    <link href="icons/Icon-192.png" rel="apple-touch-icon">

    <!-- Favicon -->
    <link href="favicon.png" rel="icon" type="image/png"/>

    <title>fl_app1</title>
    <link href="manifest.json" rel="manifest">

    <!-- POW WASM Module -->
    <script type="module">
        // é¢„åŠ è½½ WASM æ¨¡å—ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡é¡µé¢åŠ è½½ï¼‰
        (async () => {
            try {
                const wasmModule = await import('./wasm/pow_wasm.js');
                await wasmModule.default();

                // å°†WASMå‡½æ•°æš´éœ²åˆ°å…¨å±€windowå¯¹è±¡
                window.POWSolver = wasmModule.POWSolver;
                window.compute_pow_solution = wasmModule.compute_pow_solution;
                window.verify_solution = wasmModule.verify_solution;
                window.get_version = wasmModule.get_version;

                console.log('âœ… POW WASM module loaded (version: ' + wasmModule.get_version() + ')');
                window.__powWasmReady = true;
            } catch (e) {
                console.warn('âš ï¸  POW WASM module not available:', e);
                window.__powWasmReady = false;

                // åˆ¤æ–­æ˜¯å¦æ˜¯æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜
                const isCompatError = e.message && (
                    e.message.includes('references are not enabled') ||
                    e.message.includes("doesn't parse") ||
                    e.message.includes('WebAssembly.Module')
                );

                if (isCompatError) {
                    console.error('âŒ æµè§ˆå™¨ä¸å…¼å®¹ WebAssembly');
                    console.error('è¯·ä½¿ç”¨ä»¥ä¸‹æµè§ˆå™¨ä¹‹ä¸€:');
                    console.error('  - Chrome 70+ (2018å¹´10æœˆ)');
                    console.error('  - Firefox 70+ (2019å¹´10æœˆ)');
                    console.error('  - Safari 13+ (2019å¹´9æœˆ)');
                    console.error('  - Edge 79+ (2020å¹´1æœˆ)');
                    console.error('');
                    console.error('å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å›½äº§æµè§ˆå™¨ï¼Œè¯·æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬æˆ–åˆ‡æ¢åˆ°ä¸Šè¿°æµè§ˆå™¨ã€‚');

                    window.__powWasmCompatError = true;
                } else {
                    console.error('WASMåŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨çº¯Dartå›é€€å®ç°');
                }
            }
        })();

        // è°ƒè¯•å‡½æ•°ï¼šæ£€æŸ¥å½“å‰POWè®¡ç®—æ¨¡å¼
        window.checkPOWMode = function () {
            if (window.__powWasmCompatError) {
                console.log('âŒ æµè§ˆå™¨ä¸å…¼å®¹ WebAssembly');
                console.log('å»ºè®®å‡çº§æµè§ˆå™¨åˆ° Chrome 70+, Firefox 70+, Safari 13+ æˆ– Edge 79+');
                return 'INCOMPATIBLE';
            } else if (window.__powWasmReady && window.POWSolver) {
                console.log('ğŸš€ å½“å‰æ¨¡å¼: WASM (é«˜æ€§èƒ½)');
                console.log('ğŸ“¦ WASMç‰ˆæœ¬:', window.get_version());
                console.log('âš¡ é¢„æœŸæ€§èƒ½: ~1-2ç§’ (80æŒ‘æˆ˜)');
                return 'WASM';
            } else {
                console.log('ğŸŒ å½“å‰æ¨¡å¼: çº¯Dart (å›é€€æ¨¡å¼)');
                console.log('â±ï¸ é¢„æœŸæ€§èƒ½: ~8-10ç§’ (80æŒ‘æˆ˜)');
                return 'Dart';
            }
        };
    </script>

    <!-- Crisp Chat Integration -->
    <script type="text/javascript">
        window.$crisp = [];
        window.CRISP_WEBSITE_ID = "04e5a5e9-2e6e-4102-a99b-dd10d50b6d80"; // è¯·æ›¿æ¢ä¸ºå®é™…çš„ Crisp Website ID

        (function () {
            var d = document;
            var s = d.createElement("script");
            s.src = "https://client.crisp.chat/l.js";
            s.async = 1;
            d.getElementsByTagName("head")[0].appendChild(s);
        })();

        // æä¾›ç»™ Flutter è°ƒç”¨çš„å‡½æ•°
        function openCrispChat() {
            if (window.$crisp) {
                window.$crisp.push(["do", "chat:open"]);
            }
        }

        function setCrispUserEmail(email) {
            if (window.$crisp) {
                window.$crisp.push(["set", "user:email", [email]]);
            }
        }

        function setCrispUserNickname(nickname) {
            if (window.$crisp) {
                window.$crisp.push(["set", "user:nickname", [nickname]]);
            }
        }
    </script>
    <style>
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .loading-text {
            font-size: 24px;
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .browser-warning {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            text-align: center;
            font-size: 14px;
            line-height: 1.6;
            display: none;
        }

        .browser-warning a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .browser-warning a:hover {
            text-decoration: underline;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        noscript .browser-warning {
            display: block;
        }
    </style>
</head>
<body>
<noscript>
    <div class="browser-warning">
        <p lang="zh-Hans">
            æˆ‘ä»¬æ£€æµ‹åˆ°æ‚¨å½“å‰çš„æµè§ˆå™¨ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºæˆ‘ä»¬çš„ä¸»é¡µï¼Œè¯·æ›´æ–°æ‚¨çš„æµè§ˆå™¨ï¼Œå¹¶å¯ç”¨ Javascriptã€‚
        </p>
        <p lang="en">
            We detected that your current browser cannot display our homepage properly. Please update your browser and
            enable JavaScript.
        </p>
    </div>
</noscript>
<div class="loading-container" id="loading">
    <div class="loading-text" lang="zh-Hans">é¡µé¢æ­£åœ¨åŠ è½½ä¸­...</div>
    <div class="loading-text" lang="en" style="font-size: 18px; opacity: 0.8;">Loading...</div>
    <div class="loading-spinner"></div>
</div>
<script async src="flutter_bootstrap.js"></script>
<script>
    // Hide loading screen when Flutter app is ready
    window.addEventListener('flutter-first-frame', function () {
        var loadingElement = document.getElementById('loading');
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
    });
</script>
</body>
</html>
