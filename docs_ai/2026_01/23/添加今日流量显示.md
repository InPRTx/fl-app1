# 添加今日流量显示功能

## 需求描述

根据后端 Python 代码逻辑，在用户服务卡片组件中添加"今日流量"显示项。

## 后端逻辑参考

```python
def today_used_traffic(self) -> str:
    """
    TodayusedTraffic
    """
    return UtilsTools2.tools.flow_auto_show(
        self.ss_tx_size + self.ss_rx_size - self.ss_yesterday_used_size)
```

**计算公式**: 今日流量 = (上传流量 + 下载流量) - 昨日使用流量

## 实现方案

### 文件位置

`/lib/component/low_admin/user_old_service_card_component.dart`

### 修改内容

#### 1. 添加今日流量计算方法

```dart
int _calculateTodayUsedTraffic() {
  if (serviceData == null) {
    return 0;
  }
  final totalUsed = serviceData!.ssUploadSize + serviceData!.ssDownloadSize;
  final todayUsed = totalUsed - serviceData!.ssBandwidthYesterdayUsedSize;
  return todayUsed >= 0 ? todayUsed : 0;
}
```

**说明**:

- 使用 `ssUploadSize` (上传数量 u)
- 使用 `ssDownloadSize` (下载数量 d)
- 使用 `ssBandwidthYesterdayUsedSize` (昨日使用流量 last_day_t)
- 确保结果不为负数（防止数据异常）

#### 2. 在 UI 中添加显示项

在"昨日使用"和"用户等级"之间添加：

```dart
_buildInfoRow
('今日流量
'
,_formatBytes(
_calculateTodayUsedTraffic
(
)
)
,
)
,
```

## 显示效果

卡片中的信息顺序：

1. 上传流量
2. 下载流量
3. 昨日使用
4. **今日流量** ← 新增
5. 用户等级
6. 等级过期时间
7. ...其他信息

## 数据模型

使用的 `AdminOldServiceOutput` 字段：

| 字段名                            | API 字段名                            | 说明                  |
|--------------------------------|------------------------------------|---------------------|
| `ssUploadSize`                 | `ss_upload_size`                   | 上传数量 (u)            |
| `ssDownloadSize`               | `ss_download_size`                 | 下载数量 (d)            |
| `ssBandwidthYesterdayUsedSize` | `ss_bandwidth_yesterday_used_size` | 昨日使用流量 (last_day_t) |

## 验证

```bash
flutter analyze
# No errors found ✅
```

### 实际代码验证

方法已成功实现在 `UserOldServiceCardComponent` 类中：

```dart
int _calculateTodayUsedTraffic() {
  if (serviceData == null) {
    return 0;
  }
  final totalUsed = serviceData!.ssUploadSize + serviceData!.ssDownloadSize;
  final todayUsed = totalUsed - serviceData!.ssBandwidthYesterdayUsedSize;
  return todayUsed >= 0 ? todayUsed : 0;
}
```

位置：在 `_calculateUsagePercent()` 方法之后，`build()` 方法之前。

## 遵循的规范

- ✅ 使用精简方法实现功能
- ✅ 方法命名清晰（`_calculateTodayUsedTraffic`）
- ✅ 处理边界情况（null 检查、负数处理）
- ✅ 与现有代码风格保持一致
- ✅ 使用已有的 `_formatBytes` 方法格式化显示
- ✅ 非 null 时返回 0，确保类型安全

## 示例输出

- 今日流量: 512.34 MB
- 今日流量: 1.23 GB
- 今日流量: 0 B (今日未使用)

