# 修复编译错误

## 问题描述

Flutter 项目在编译时出现多个错误：

1. `auth_store.dart` 中使用了错误的刷新令牌参数模型
2. `low_admin_user_detail_page.dart` 中使用了不存在的响应类型
3. `low_admin_users_list_page.dart` 中导入了错误的数据类型
4. `bought_record_form_dialog.dart` 中使用了未导出的类型

## 错误详情

### 错误 1: auth_store.dart 参数错误

```
Error: No named parameter with the name 'refreshToken'.
      refreshToken: _refreshJWTToken!,
      ^^^^^^^^^^^^
```

**原因**: 使用了 `ParamsModel` 而不是正确的 `WebSubFastapiRoutersApiVAuthJwtTokenAccessRefreshParamsModel`

### 错误 2: low_admin_user_detail_page.dart 类型错误

```
Error: 'WebSubFastapiRoutersApiVLowAdminApiUserOldServiceGetUserOldServiceResponse' isn't a type.
```

**原因**: 使用了内部长名称类型，而应该使用导出的简化类型 `GetUserOldServiceResponse`

### 错误 3: low_admin_users_list_page.dart 类型不匹配

```
Error: The getter 'userName' isn't defined for the type 'ResultListData'.
```

**原因**: 导入了错误的 `ResultListData` 类型，应该导入
`WebSubFastapiRoutersApiVGrafanaAdminViewSearchUserGetSearchUserResultResultListData`

### 错误 4: bought_record_form_dialog.dart 未定义类

```
Error: Undefined class 'WebSubFastapiRoutersApiVLowAdminApiUserBoughtGetUserBoughtResponseResultListData'
```

**原因**: 该类型存在但未在 `api/export.dart` 中导出

## 解决方案

### 1. 修复 auth_store.dart

**文件**: `/lib/store/service/auth/auth_store.dart`

**修改**:

- 移除导入: `import 'package:fl_app1/api/models/params_model.dart';`
- 添加导入:
  `import 'package:fl_app1/api/models/web_sub_fastapi_routers_api_v_auth_jwt_token_access_refresh_params_model.dart';`
- 修改实例化代码:

```dart
// 修改前
final body = ParamsModel(
  refreshToken: _refreshJWTToken!,
);

// 修改后
final body = WebSubFastapiRoutersApiVAuthJwtTokenAccessRefreshParamsModel(
  refreshToken: _refreshJWTToken!,
);
```

### 2. 修复 low_admin_user_detail_page.dart

**文件**: `/lib/page/low_admin/user_detail/low_admin_user_detail_page.dart`

**修改**: 使用导出的简化类型名

```dart
// 修改前
_userOldServiceData =
    (results[1]
            as WebSubFastapiRoutersApiVLowAdminApiUserOldServiceGetUserOldServiceResponse)
        .result;

// 修改后
_userOldServiceData =
    (results[1] as GetUserOldServiceResponse).result;
```

### 3. 修复 low_admin_users_list_page.dart

**文件**: `/lib/page/low_admin/users_list/low_admin_users_list_page.dart`

**修改**:

- 移除导入: `import 'package:fl_app1/api/models/result_list_data.dart';`
- 添加导入:
  `import 'package:fl_app1/api/models/web_sub_fastapi_routers_api_v_grafana_admin_view_search_user_get_search_user_result_result_list_data.dart';`
- 修改方法签名:

```dart
// 修改前
Widget _buildUserCard(ResultListData user) {

// 修改后
Widget _buildUserCard(
  WebSubFastapiRoutersApiVGrafanaAdminViewSearchUserGetSearchUserResultResultListData user,
) {
```

### 4. 修复 bought_record_form_dialog.dart

**文件**: `/lib/api/export.dart`

**修改**: 添加缺失的导出

```dart
export 'models/web_sub_fastapi_routers_api_v_low_admin_api_user_bought_get_user_bought_response.dart';
export 'models/web_sub_fastapi_routers_api_v_low_admin_api_user_bought_get_user_bought_response_result_list_data.dart';
export 'models/web_sub_fastapi_routers_api_v_low_admin_api_user_money_money_recharge_it_params_model.dart';
```

**文件**: `/lib/component/bought_records/bought_records_list_component.dart`

**修改**: 移除现在已经从 export.dart 导出的重复导入

```dart
// 移除此行
import 'package:fl_app1/api/models/web_sub_fastapi_routers_api_v_low_admin_api_user_bought_get_user_bought_response_result_list_data.dart';
```

## 验证结果

执行以下命令验证修复：

```bash
flutter analyze --no-fatal-infos
flutter build macos --debug
```

**结果**: ✅ 编译成功，所有错误已解决

```
Building macOS application...
✓ Built build/macos/Build/Products/Debug/fl_app1.app
```

## 总结

1. ✅ 使用正确的 API 模型类型进行刷新令牌操作
2. ✅ 使用导出的简化类型名而非内部长名称
3. ✅ 导入正确的用户搜索结果数据类型
4. ✅ 在 export.dart 中添加缺失的类型导出
5. ✅ 移除重复的导入语句

## 遵循的规范

- ✅ 不修改 `/lib/api` 下的自动生成代码（仅添加必要的 export）
- ✅ 使用完整的 Model 参数，避免手动构造 query string
- ✅ 所有 API 调用均使用 model 参数
- ✅ 确保类型声明明确，包括泛型

