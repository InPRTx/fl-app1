d# æ³¨å†Œé¡µé¢é‚€è¯·ç URLå‚æ•°åŠŸèƒ½

**æ—¥æœŸ**: 2026-01-16  
**çŠ¶æ€**: âœ… å·²å®ç°

## åŠŸèƒ½æ¦‚è¿°

æ³¨å†Œé¡µé¢ç°åœ¨æ”¯æŒé€šè¿‡URLå‚æ•°ä¼ é€’é‚€è¯·ç ï¼Œå¹¶è‡ªåŠ¨æ ¡éªŒé‚€è¯·ç æœ‰æ•ˆæ€§ã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. URLæ ¼å¼

```
/auth/register?invite_code=YOUR_INVITE_CODE
```

**ç¤ºä¾‹**:

```
/auth/register?invite_code=ABC123XYZ
/auth/register?invite_code=FRIEND2024
```

### 2. è·¯ç”±é…ç½®

åœ¨ `app_router.dart` ä¸­å·²é…ç½®æ”¯æŒé‚€è¯·ç å‚æ•°ï¼š

```dart
@RoutePage()
class AuthRegisterPage extends StatefulWidget {
  const AuthRegisterPage({super.key, this.inviteCode});

  final String? inviteCode;

// ...
}
```

è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±ï¼š

```dart
AuthRegisterRoute
({
Key? key,
String? inviteCode, // æ”¯æŒé‚€è¯·ç å‚æ•°
List<PageRouteInfo>? children,
})
```

## åŠŸèƒ½ç‰¹æ€§

### âœ… è‡ªåŠ¨å¡«å……

å½“URLåŒ…å« `invite_code` å‚æ•°æ—¶ï¼š

1. é¡µé¢åŠ è½½åè‡ªåŠ¨å¡«å……é‚€è¯·ç è¾“å…¥æ¡†
2. å»¶è¿Ÿ500msåè‡ªåŠ¨è§¦å‘æ ¡éªŒ

```dart
if (widget.inviteCode != null && widget.inviteCode!.isNotEmpty) {
_inviteCodeController.text = widget.inviteCode!;
Future<void>.delayed(const Duration(milliseconds: 500), _checkInviteCode);
}
```

### âœ… è‡ªåŠ¨æ ¡éªŒ

é‚€è¯·ç è‡ªåŠ¨æ ¡éªŒçš„æ—¶æœºï¼š

1. **é¡µé¢åŠ è½½æ—¶**ï¼ˆå¦‚æœURLåŒ…å«é‚€è¯·ç ï¼‰
2. **å¤±ç„¦æ—¶**ï¼ˆonEditingCompleteï¼‰
3. **æŒ‰å›è½¦æ—¶**ï¼ˆonFieldSubmittedï¼‰

```dart
TextFormField
(
controller: _inviteCodeController,
onEditingComplete: () {
if (_inviteCodeController.text.trim().isNotEmpty) {
_checkInviteCode();
}
},
onFieldSubmitted: (String v) {
if (v.isNotEmpty) {
_checkInviteCode();
}
},
)
```

### âœ… æ ¡éªŒçŠ¶æ€æ˜¾ç¤º

é‚€è¯·ç æœ‰å››ç§çŠ¶æ€ï¼š

| çŠ¶æ€          | å›¾æ ‡     | æç¤º           |
|-------------|--------|--------------|
| `unchecked` | æ—       | æœªæ ¡éªŒ          |
| `checking`  | ğŸ”„ åŠ è½½ä¸­ | "æ­£åœ¨æ ¡éªŒé‚€è¯·ç ..." |
| `valid`     | âœ… ç»¿è‰²å¯¹å‹¾ | "é‚€è¯·ç æœ‰æ•ˆ"      |
| `invalid`   | âŒ çº¢è‰²é”™è¯¯ | å…·ä½“é”™è¯¯ä¿¡æ¯       |

```dart
enum InviteCodeState { unchecked, checking, valid, invalid }
```

### âœ… ç”¨æˆ·äº¤äº’

1. **æ¸…ç©ºè¾“å…¥æ—¶**ï¼šè‡ªåŠ¨é‡ç½®ä¸º `unchecked` çŠ¶æ€
2. **è¾“å…¥æ–°å†…å®¹åå¤±ç„¦**ï¼šè‡ªåŠ¨æ ¡éªŒ
3. **æ‰‹åŠ¨è¾“å…¥åæŒ‰å›è½¦**ï¼šè‡ªåŠ¨æ ¡éªŒ

## APIè°ƒç”¨

### æ ¡éªŒé‚€è¯·ç æ¥å£

```dart
Future<void> _checkInviteCode() async {
  final String inviteCode = _inviteCodeController.text.trim();

  final CheckInviteCodeParamsModel body = CheckInviteCodeParamsModel(
    inviteCode: inviteCode,
  );

  final response = await rest.fallback
      .postCheckInviteCodeApiV2AuthAccountRegisterCheckInviteCodePost(
    body: body,
  );

  // æ ¹æ®å“åº”æ›´æ–°çŠ¶æ€
  if (response.isSuccess) {
    _inviteCodeState = InviteCodeState.valid;
    _inviteCodeMessage = response.message;
  } else {
    _inviteCodeState = InviteCodeState.invalid;
    _inviteCodeMessage = response.message;
  }
}
```

## ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯1: é€šè¿‡é‚€è¯·é“¾æ¥æ³¨å†Œ

1. ç”¨æˆ·ç‚¹å‡»é‚€è¯·é“¾æ¥: `https://app.example.com/auth/register?invite_code=ABC123`
2. é¡µé¢åŠ è½½ï¼Œé‚€è¯·ç è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†
3. 500msåè‡ªåŠ¨æ ¡éªŒé‚€è¯·ç 
4. æ˜¾ç¤ºæ ¡éªŒç»“æœï¼ˆâœ… æœ‰æ•ˆ æˆ– âŒ æ— æ•ˆï¼‰
5. ç”¨æˆ·ç»§ç»­å¡«å†™å…¶ä»–ä¿¡æ¯å¹¶æ³¨å†Œ

### åœºæ™¯2: æ‰‹åŠ¨è¾“å…¥é‚€è¯·ç 

1. ç”¨æˆ·ç›´æ¥è®¿é—®æ³¨å†Œé¡µé¢
2. æ‰‹åŠ¨è¾“å…¥é‚€è¯·ç 
3. å¤±ç„¦æˆ–æŒ‰å›è½¦æ—¶è‡ªåŠ¨æ ¡éªŒ
4. æ˜¾ç¤ºæ ¡éªŒç»“æœ
5. ç”¨æˆ·ç»§ç»­å¡«å†™å…¶ä»–ä¿¡æ¯å¹¶æ³¨å†Œ

### åœºæ™¯3: ä¿®æ”¹é‚€è¯·ç 

1. URLå¸¦æœ‰é‚€è¯·ç ï¼Œä½†ç”¨æˆ·æƒ³ä¿®æ”¹
2. æ¸…ç©ºè¾“å…¥æ¡† â†’ çŠ¶æ€é‡ç½®
3. è¾“å…¥æ–°é‚€è¯·ç  â†’ å¤±ç„¦æ—¶è‡ªåŠ¨æ ¡éªŒ
4. æ˜¾ç¤ºæ–°çš„æ ¡éªŒç»“æœ

## è§†è§‰åé¦ˆ

### æ ¡éªŒä¸­çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ é‚€è¯·ç ï¼ˆå¯é€‰ï¼‰               â”‚
â”‚ ABC123                          â”‚
â”‚ æ­£åœ¨æ ¡éªŒé‚€è¯·ç ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ‰æ•ˆçŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… é‚€è¯·ç ï¼ˆå¯é€‰ï¼‰               â”‚
â”‚ ABC123                          â”‚
â”‚ é‚€è¯·ç æœ‰æ•ˆ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ— æ•ˆçŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ é‚€è¯·ç ï¼ˆå¯é€‰ï¼‰               â”‚
â”‚ INVALID                         â”‚
â”‚ é‚€è¯·ç æ— æ•ˆæˆ–å·²ä½¿ç”¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. å‚æ•°ä¼ é€’

è·¯ç”±è‡ªåŠ¨å¤„ç†æŸ¥è¯¢å‚æ•°ï¼š

```dart
// URL: /auth/register?invite_code=ABC123
// è‡ªåŠ¨è½¬æ¢ä¸º:
AuthRegisterRoute
(
inviteCode
:
'
ABC123
'
)
```

### 2. çŠ¶æ€ç®¡ç†

```dart
// ä¸‰ä¸ªçŠ¶æ€å˜é‡
bool _isCheckingInvite = false; // æ˜¯å¦æ­£åœ¨æ ¡éªŒ
InviteCodeState _inviteCodeState =
...; // æ ¡éªŒçŠ¶æ€
String _inviteCodeMessage = ''; // æç¤ºæ¶ˆæ¯
```

### 3. é˜²æŠ–ä¼˜åŒ–

é¡µé¢åŠ è½½æ—¶å»¶è¿Ÿ500msæ‰æ ¡éªŒï¼Œé¿å…ï¼š

- é¡µé¢è¿˜æœªå®Œå…¨æ¸²æŸ“
- ç”¨æˆ·çœ‹åˆ°çªç„¶çš„çŠ¶æ€å˜åŒ–
- APIè°ƒç”¨è¿‡æ—©

## æ³¨æ„äº‹é¡¹

### âš ï¸ å¯é€‰å­—æ®µ

é‚€è¯·ç æ˜¯**å¯é€‰**çš„ï¼Œä¸å¡«å†™ä¹Ÿèƒ½æ­£å¸¸æ³¨å†Œï¼š

```dart
inviteCode: _inviteCodeController.text.trim
().isEmpty
? null:
_inviteCodeController.text.trim
(),
```

### âš ï¸ é”™è¯¯å¤„ç†

ç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½æç¤ºï¼š

```dart
catch (e) {
_inviteCodeState = InviteCodeState.invalid;
_inviteCodeMessage = 'æ ¡éªŒé‚€è¯·ç æ—¶å‘ç”Ÿé”™è¯¯';
}
```

### âš ï¸ é¡µé¢å¸è½½

å¦‚æœç”¨æˆ·å¿«é€Ÿç¦»å¼€é¡µé¢ï¼Œä¸ä¼šå¯¼è‡´é”™è¯¯ï¼š

```dart
if (
!
mounted
)
return; // æ ¡éªŒè¿”å›å‰æ£€æŸ¥
```

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1: URLå‚æ•°åŠ è½½

```
è®¿é—®: /auth/register?invite_code=TEST123
é¢„æœŸ: 
- é‚€è¯·ç è¾“å…¥æ¡†æ˜¾ç¤º "TEST123"
- 500msåè‡ªåŠ¨æ ¡éªŒ
- æ˜¾ç¤ºæ ¡éªŒç»“æœ
```

### æµ‹è¯•2: æ‰‹åŠ¨è¾“å…¥

```
æ­¥éª¤:
1. è®¿é—® /auth/register
2. è¾“å…¥é‚€è¯·ç  "MANUAL456"
3. ç‚¹å‡»å…¶ä»–è¾“å…¥æ¡†ï¼ˆå¤±ç„¦ï¼‰

é¢„æœŸ:
- è‡ªåŠ¨è§¦å‘æ ¡éªŒ
- æ˜¾ç¤ºæ ¡éªŒç»“æœ
```

### æµ‹è¯•3: æ¸…ç©ºé‡ç½®

```
æ­¥éª¤:
1. è¾“å…¥é‚€è¯·ç å¹¶æ ¡éªŒ
2. æ¸…ç©ºé‚€è¯·ç è¾“å…¥æ¡†

é¢„æœŸ:
- çŠ¶æ€é‡ç½®ä¸º unchecked
- å›¾æ ‡å’Œæç¤ºæ¶ˆæ¯æ¶ˆå¤±
```

### æµ‹è¯•4: æ— æ•ˆé‚€è¯·ç 

```
è¾“å…¥æ— æ•ˆé‚€è¯·ç 
é¢„æœŸ:
- æ˜¾ç¤ºçº¢è‰²é”™è¯¯å›¾æ ‡
- æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- ä»ç„¶å¯ä»¥ç»§ç»­æ³¨å†Œï¼ˆé‚€è¯·ç å¯é€‰ï¼‰
```

## å¯¹æ¯”å‚è€ƒï¼ˆVueç‰ˆæœ¬ï¼‰

å‚è€ƒçš„Vueå®ç°ï¼š

```vue
// ä»URLå‚æ•°ä¸­è·å–é‚€è¯·ç 
const inviteCode = route.query.invite_code as string
if (inviteCode) {
formData.value.inviteCode = inviteCode
await checkInviteCode()
}
```

Flutterå®ç°å·®å¼‚ï¼š

- Vue: ç›´æ¥ä» `route.query` è·å–
- Flutter: é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’åˆ°æ„é€ å‡½æ•°

## æœªæ¥ä¼˜åŒ–å»ºè®®

1. **é¢„åŠ è½½é‚€è¯·ä¿¡æ¯**
    - æ ¡éªŒæˆåŠŸåæ˜¾ç¤ºé‚€è¯·äººæ˜µç§°
    - æ˜¾ç¤ºé‚€è¯·å¥–åŠ±ä¿¡æ¯

2. **é‚€è¯·ç æ ¼å¼åŒ–**
    - è‡ªåŠ¨è½¬æ¢ä¸ºå¤§å†™
    - è‡ªåŠ¨å»é™¤ç©ºæ ¼

3. **ç»Ÿè®¡åˆ†æ**
    - è®°å½•é‚€è¯·ç æ¥æº
    - ç»Ÿè®¡è½¬åŒ–ç‡

4. **é”™è¯¯é‡è¯•**
    - ç½‘ç»œå¤±è´¥æ—¶æä¾›é‡è¯•æŒ‰é’®
    - è‡ªåŠ¨é‡è¯•æœºåˆ¶

---

**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´å®ç°  
**æµ‹è¯•**: éœ€è¦å®é™…æµ‹è¯•URLå‚æ•°åŠŸèƒ½  
**æ–‡æ¡£**: å·²å®Œæˆ

