# 登录页面实时表单验证

## 更新时间

2025年11月05日

## 更新内容

### 问题描述

登录页面的表单验证只在提交时进行检查，用户无法在输入过程中实时看到警告信息，导致用户体验不佳。

### 解决方案

实现了实时表单验证功能，用户开始输入后立即显示验证结果，避免打开页面就显示错误警告。

### 具体修改

#### 1. Form 组件配置

设置 Form 的 `autovalidateMode` 为 `AutovalidateMode.onUserInteraction`：

```dart
Form(
  key: _formKey,
  autovalidateMode: AutovalidateMode.onUserInteraction,
  child: Column(
    // ...
  ),
)
```

#### 2. 邮箱输入框验证

- 移除不必要的 `onChanged` 回调
- 验证规则：
    - 检查是否为空
    - 检查邮箱格式是否有效（使用正则表达式 `^[^@\s]+@[^@\s]+\.[^@\s]+$`）

#### 3. 密码输入框验证

- 移除不必要的 `onChanged` 回调
- 添加 `textInputAction: TextInputAction.next` 优化输入流程
- 验证规则：
    - 检查是否为空
    - 检查密码长度至少6位

#### 4. 两步验证码输入框验证

- `onChanged` 回调仅用于限制输入长度不超过6位
- 验证规则：
    - 可选字段（为空时返回 null）
    - 必须是6位数字
    - 只能包含数字字符

#### 5. 代码精简

- 移除不必要的 `_autovalidateMode` 状态变量
- 移除所有验证触发的 `onChanged` 逻辑
- 简化 `_handleSubmit()` 方法，移除状态切换代码

### 用户体验改进

1. **无干扰启动**：页面打开时不显示任何验证错误
2. **即时反馈**：用户开始输入或交互后立即显示验证状态
3. **实时纠正**：用户修正输入时，错误提示会立即更新或消失
4. **视觉震动**：验证失败时保留抖动动画，增强视觉反馈

### 验证规则总结

| 字段    | 必填 | 验证规则       | 错误提示                       |
|-------|----|------------|----------------------------|
| 邮箱    | 是  | 不为空 + 邮箱格式 | "请输入邮箱" / "请输入有效邮箱"        |
| 密码    | 是  | 不为空 + 至少6位 | "请输入密码" / "密码至少6位"         |
| 两步验证码 | 否  | 为空或6位数字    | "验证码必须是6位数字" / "验证码只能包含数字" |

### 技术实现

使用 Flutter 的 `AutovalidateMode.onUserInteraction` 模式：

- Form 组件设置 `autovalidateMode: AutovalidateMode.onUserInteraction`
- 每个 TextFormField 的 `validator` 在用户交互（输入、编辑）后自动触发
- 无需额外的状态管理和手动触发验证逻辑
- 避免页面初始加载时显示验证错误

### 文件修改

- `/lib/pages/auth/account_login/login_page.dart`

### 相关编码规范

- 遵循精简代码原则，移除所有不必要的代码
- 所有验证逻辑直接返回结果，无冗余判断
- 利用 Flutter 框架自动验证机制，避免手动触发

