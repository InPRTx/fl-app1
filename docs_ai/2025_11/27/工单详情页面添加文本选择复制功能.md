# 工单详情页面添加文本选择复制功能

## 日期

2025年11月27日

## 修改文件

- `/lib/page/low_admin/ticket_detail/low_admin_ticket_detail_page.dart`

## 功能描述

为工单详情页面添加了文本选择和复制功能，用户可以直接选中并复制页面中的重要信息，包括工单标题、用户名、消息内容、时间等。

## 技术实现

### 1. 将 Text 组件替换为 SelectableText

#### 1.1 工单标题

允许选择和复制工单标题：

```dart
Row
(
children: [
Expanded(
child: SelectableText(
_ticket!.title,
style: const TextStyle(
fontSize: 20,
fontWeight: FontWeight.bold,
),
)
,
)
,
// ...状态标签...
]
,
)
,
```

#### 1.2 工单所有者名称

允许选择和复制创建工单的用户名：

```dart
Row
(
children: [
CircleAvatar(
// ...头像配置...
),
const SizedBox(width: 8),
Expanded(
child: SelectableText(
ownerName,
style: const TextStyle(fontSize: 14),
),
),
],
),
```

#### 1.3 工单信息行（时间、ID等）

允许选择和复制工单的详细信息：

```dart
Widget _buildInfoRow(IconData icon, String label, String value) {
  return Row(
    children: [
      Icon(icon, size: 20, color: Colors.grey[600]),
      const SizedBox(width: 8),
      Text(
        '$label: ',
        style: TextStyle(
          fontSize: 14,
          color: Colors.grey[700],
          fontWeight: FontWeight.w500,
        ),
      ),
      Expanded(
        child: SelectableText(
          value,
          style: const TextStyle(fontSize: 14),
        ),
      ),
    ],
  );
}
```

#### 1.4 消息卡片中的用户信息

允许选择和复制消息发送者的用户名和ID：

```dart
Row
(
children: [
Flexible(
child: SelectableText(
msgName,
style: TextStyle(
fontWeight: FontWeight.bold,
color: isAdmin ? Colors.blue[700] : null,
),
),
),
const SizedBox(width: 8),
SelectableText(
'ID: ${message.userId}',
style: TextStyle(
fontSize: 12,
color: Colors.grey[600],
),
),
],
)
,
```

#### 1.5 消息时间

允许选择和复制消息的创建时间：

```dart
SelectableText
(
dateFormat.format(message.createdAt.toLocal()),
style: TextStyle(fontSize: 12, color: Colors.grey[600]),
)
,
```

#### 1.6 消息内容

允许选择和复制完整的消息内容：

```dart
SelectableText
(
message.content,
style: const TextStyle(fontSize: 14
,
height
:
1.5
)
,
)
,
```

### 2. 已有的复制按钮功能

页面已经实现了消息内容的一键复制按钮：

```dart
IconButton
(
icon: const Icon(Icons.copy, size: 18),
onPressed: () {
Clipboard.setData(ClipboardData(text: message.content));
ScaffoldMessenger.of(context).showSnackBar(
const SnackBar(
content: Text('消息内容已复制'),
duration: Duration(seconds: 1),
),
);
},
tooltip
:
'
复制内容
'
,
)
,
```

## 改进内容总结

### 可选择复制的内容

1. ✅ **工单标题** - 可以选中复制
2. ✅ **工单所有者名称** - 可以选中复制
3. ✅ **创建时间** - 可以选中复制
4. ✅ **更新时间** - 可以选中复制
5. ✅ **消息发送者名称** - 可以选中复制
6. ✅ **消息发送者ID** - 可以选中复制
7. ✅ **消息创建时间** - 可以选中复制
8. ✅ **消息内容** - 可以选中复制

### 两种复制方式

1. **文本选择复制**：用户可以长按或拖动选择任意文本进行复制
2. **一键复制按钮**：点击消息卡片右上角的复制图标，快速复制整条消息内容

## 用户体验改进

### 1. 文本选择灵活性

- 用户可以选择复制部分文本，而不是只能复制全部
- 支持跨行、跨字段的文本选择
- 与原生系统的文本选择行为一致

### 2. 视觉一致性

- `SelectableText` 保持了与原 `Text` 组件相同的样式
- 不影响页面的视觉布局和设计
- 选中文本时会有系统默认的高亮效果

### 3. 操作便捷性

- Web端：鼠标拖动选择，Ctrl+C/Cmd+C 复制
- 移动端：长按选择，使用系统复制菜单
- 桌面端：鼠标拖动选择，右键菜单或快捷键复制

## SelectableText vs Text 对比

| 特性   | Text   | SelectableText |
|------|--------|----------------|
| 文本选择 | ❌ 不支持  | ✅ 支持           |
| 复制功能 | ❌ 不支持  | ✅ 支持           |
| 样式支持 | ✅ 完全支持 | ✅ 完全支持         |
| 性能   | 🟢 最优  | 🟡 稍低（可忽略）     |
| 手势识别 | ✅ 点击等  | ⚠️ 选择手势优先      |

## 注意事项

### 1. 组件选择

- **可复制的信息**使用 `SelectableText`
- **纯展示性标签**（如"创建时间:"）仍使用 `Text`
- **按钮文字**仍使用 `Text`

### 2. 布局考虑

- `SelectableText` 需要包裹在 `Expanded` 或 `Flexible` 中以避免溢出
- 在 `Row` 中使用时注意文本换行行为

### 3. 用户交互

- `SelectableText` 会拦截点击手势用于文本选择
- 如果需要点击事件，应使用 `InkWell` 包裹或保持使用 `Text`

## 测试建议

### Web端测试

1. 鼠标拖动选择工单标题
2. 双击选择单个单词
3. Ctrl+C 复制选中内容
4. 浏览器右键菜单复制

### 移动端测试

1. 长按文本触发选择
2. 拖动选择手柄调整选择范围
3. 点击系统复制按钮
4. 测试消息内容的一键复制按钮

### 桌面端测试

1. 鼠标拖动选择
2. 双击/三击选择
3. 键盘快捷键复制（Ctrl+C / Cmd+C）
4. 右键菜单复制

## 代码质量

### 遵循的规范

1. ✅ 使用 `const` 修饰不变的组件
2. ✅ 保持原有的样式定义
3. ✅ 不引入新的依赖
4. ✅ 保持代码的可读性和简洁性

### 向后兼容性

- 所有修改都是组件级别的替换
- 不影响数据流和状态管理
- 保持与原有功能的完全兼容

## 后续优化建议

1. 可以添加"复制所有信息"的快捷按钮
2. 可以添加自定义复制菜单（格式化复制）
3. 可以添加复制历史记录功能
4. 可以根据用户权限控制可复制的内容

