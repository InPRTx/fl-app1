# è´­ä¹°è®°å½•é¡µé¢ç»„ä»¶åŒ–é‡æ„

## æ—¥æœŸ

2025å¹´11æœˆ19æ—¥

## æ“ä½œè¯´æ˜

### èƒŒæ™¯

åŸå…ˆè´­ä¹°è®°å½•ç›¸å…³åŠŸèƒ½åˆ†æ•£åœ¨ä¸¤ä¸ªé¡µé¢ä¸­ï¼Œå­˜åœ¨å¤§é‡é‡å¤ä»£ç ï¼š

- `low_admin_user_bought_records_page.dart` - å•ä¸ªç”¨æˆ·çš„è´­ä¹°è®°å½•é¡µé¢
- `low_admin_user_bought_list_page.dart` - æ‰€æœ‰ç”¨æˆ·çš„è´­ä¹°è®°å½•åˆ—è¡¨é¡µé¢

### é‡æ„å†…å®¹

#### 1. åˆ›å»ºå¯å¤ç”¨ç»„ä»¶

**æ–‡ä»¶è·¯å¾„**: `/lib/component/bought_records/bought_records_list_component.dart`

åˆ›å»ºäº† `BoughtRecordsListComponent` ç»„ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

##### ç»„ä»¶å‚æ•°

```dart
class BoughtRecordsListComponent extends StatefulWidget {
  /// æŒ‡å®šç”¨æˆ·IDï¼Œå¦‚æœä¸ºnullåˆ™æ˜¾ç¤ºæ‰€æœ‰è®°å½•
  final int? userId;

  /// æ˜¯å¦æ˜¾ç¤ºç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®
  final bool isShowActions;

  /// æ˜¯å¦å¯ä»¥ç‚¹å‡»ç”¨æˆ·IDè·³è½¬
  final bool isEnableUserIdNavigation;
}
```

##### æ ¸å¿ƒåŠŸèƒ½

1. **åˆ†é¡µåŠ è½½** - è‡ªåŠ¨åŠ è½½æ›´å¤šè®°å½•ï¼Œæ¯é¡µ50æ¡
2. **ä¸‹æ‹‰åˆ·æ–°** - æ”¯æŒä¸‹æ‹‰åˆ·æ–°æ•°æ®
3. **ç¼–è¾‘è®°å½•** - å¯ç¼–è¾‘å•†å“IDã€é‡‘é¢ã€è´­ä¹°æ—¶é—´
4. **åˆ é™¤è®°å½•** - å¸¦ç¡®è®¤å¯¹è¯æ¡†çš„åˆ é™¤åŠŸèƒ½
5. **æ—¶é—´å¤„ç†** - æ­£ç¡®å¤„ç†UTCä¸æœ¬åœ°æ—¶é—´è½¬æ¢
6. **ç”¨æˆ·å¯¼èˆª** - å¯é€‰çš„ç”¨æˆ·IDç‚¹å‡»è·³è½¬åŠŸèƒ½

##### æ—¶é—´å¤„ç†è§„èŒƒ

- APIè¿”å›UTCæ—¶é—´ï¼Œä½¿ç”¨ `tz.TZDateTime.from(dateTime, tz.local)` è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
- æ˜¾ç¤ºä½¿ç”¨æœ¬åœ°æ—¶é—´æ ¼å¼åŒ–
- æ—¶é—´æ¯”è¾ƒä½¿ç”¨ `tz.TZDateTime.now(tz.local)` ç¡®ä¿åŒä¸€æ—¶åŒº
- æäº¤APIæ—¶ä½¿ç”¨ `.toUtc()` è½¬å›UTCæ—¶é—´

#### 2. é‡æ„ç”¨æˆ·è´­ä¹°è®°å½•é¡µé¢

**æ–‡ä»¶è·¯å¾„**: `/lib/page/low_admin/user_bought_records/low_admin_user_bought_records_page.dart`

**é‡æ„å‰**: 280+ è¡Œä»£ç ï¼ŒåŒ…å«å®Œæ•´çš„çŠ¶æ€ç®¡ç†ã€APIè°ƒç”¨ã€UIæ¸²æŸ“
**é‡æ„å**: 23 è¡Œä»£ç ï¼Œä½¿ç”¨ `BoughtRecordsListComponent`

```dart
class LowAdminUserBoughtRecordsPage extends StatelessWidget {
  final int userId;

  const LowAdminUserBoughtRecordsPage({super.key, required this.userId});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('è´­ä¹°è®°å½• - ç”¨æˆ·ID: $userId'),
      ),
      body: BoughtRecordsListComponent(
        userId: userId,
        isShowActions: true,
        isEnableUserIdNavigation: false,
      ),
    );
  }
}
```

#### 3. é‡æ„è´­ä¹°è®°å½•åˆ—è¡¨é¡µé¢

**æ–‡ä»¶è·¯å¾„**: `/lib/page/low_admin/user_bought_list/low_admin_user_bought_list_page.dart`

**é‡æ„å‰**: 520+ è¡Œä»£ç ï¼ŒåŒ…å«æœç´¢æ¡†ã€åˆ†é¡µã€APIè°ƒç”¨ã€UIæ¸²æŸ“
**é‡æ„å**: 80+ è¡Œä»£ç ï¼Œä¸“æ³¨äºæœç´¢è¿‡æ»¤é€»è¾‘

```dart
class _LowAdminUserBoughtListPageState extends State<LowAdminUserBoughtListPage> {
  final TextEditingController _userIdController = TextEditingController();
  int? _filterUserId;

  void _searchByUserId() {
    final text = _userIdController.text.trim();
    setState(() {
      _filterUserId = text.isEmpty ? null : int.tryParse(text);
    });
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        // æœç´¢æ¡†
        Expanded(
          child: BoughtRecordsListComponent(
            key: ValueKey(_filterUserId),
            userId: _filterUserId,
            isShowActions: false,
            isEnableUserIdNavigation: true,
          ),
        ),
      ],
    );
  }
}
```

### ç»„ä»¶ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šæ˜¾ç¤ºç‰¹å®šç”¨æˆ·çš„è´­ä¹°è®°å½•ï¼ˆå¸¦ç¼–è¾‘åŠŸèƒ½ï¼‰

```dart
BoughtRecordsListComponent
(
userId: 123,
isShowActions: true,
isEnableUserIdNavigation: false,
)
```

#### åœºæ™¯2ï¼šæ˜¾ç¤ºæ‰€æœ‰è´­ä¹°è®°å½•ï¼ˆå¯ç‚¹å‡»ç”¨æˆ·IDè·³è½¬ï¼‰

```dart
BoughtRecordsListComponent
(
userId: null,
isShowActions: false,
isEnableUserIdNavigation: true,
)
```

#### åœºæ™¯3ï¼šå¸¦æœç´¢è¿‡æ»¤çš„è´­ä¹°è®°å½•åˆ—è¡¨

```dart
BoughtRecordsListComponent
(
key: ValueKey(_filterUserId), // ç¡®ä¿userIdå˜åŒ–æ—¶é‡å»ºç»„ä»¶
userId: _filterUserId,
isShowActions
:
false
,
isEnableUserIdNavigation
:
true
,
)
```

### ä»£ç ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡         | é‡æ„å‰          | é‡æ„å     | ä¼˜åŒ–   |
|------------|--------------|---------|------|
| **æ€»ä»£ç è¡Œæ•°**  | ~800 è¡Œ       | ~600 è¡Œ  | -25% |
| **é‡å¤ä»£ç **   | é«˜ï¼ˆå¤§é‡UIå’Œé€»è¾‘é‡å¤ï¼‰ | ä½ï¼ˆå¤ç”¨ç»„ä»¶ï¼‰ | -70% |
| **ç»´æŠ¤éš¾åº¦**   | éœ€è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªæ–‡ä»¶   | åªéœ€ä¿®æ”¹ç»„ä»¶  | å¤§å¹…é™ä½ |
| **ç”¨æˆ·è®°å½•é¡µé¢** | 280+ è¡Œ       | 23 è¡Œ    | -92% |
| **åˆ—è¡¨é¡µé¢**   | 520+ è¡Œ       | 80+ è¡Œ   | -85% |

### æŠ€æœ¯äº®ç‚¹

1. **å•ä¸€èŒè´£åŸåˆ™**
    - ç»„ä»¶ä¸“æ³¨äºè´­ä¹°è®°å½•åˆ—è¡¨çš„å±•ç¤ºå’Œæ“ä½œ
    - é¡µé¢ä¸“æ³¨äºå¸ƒå±€å’Œè¿‡æ»¤é€»è¾‘

2. **å‚æ•°åŒ–é…ç½®**
    - é€šè¿‡å‚æ•°æ§åˆ¶åŠŸèƒ½å¼€å…³
    - æ— éœ€ä¿®æ”¹ä»£ç å³å¯é€‚åº”ä¸åŒåœºæ™¯

3. **æ—¶é—´å¤„ç†è§„èŒƒ**
    - ç»Ÿä¸€ä½¿ç”¨ `timezone` åŒ…å¤„ç†æ—¶åŒº
    - ä¸¥æ ¼åŒºåˆ†UTCå’Œæœ¬åœ°æ—¶é—´

4. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**
    - ä½¿ç”¨ `ValueKey` ç¡®ä¿ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶æ­£ç¡®é‡å»ºç»„ä»¶
    - ç»„ä»¶å†…éƒ¨ç®¡ç†è‡ªèº«çŠ¶æ€ï¼Œé¡µé¢åªç®¡ç†è¿‡æ»¤å‚æ•°

5. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
    - ä¿ç•™äº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½
    - æ·»åŠ äº†ä¸‹æ‹‰åˆ·æ–°
    - ç»Ÿä¸€çš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€å±•ç¤º

### ä¾èµ–åŒ…

```yaml
dependencies:
  timezone: ^0.9.0  # æ—¶åŒºå¤„ç†
  intl: ^0.18.0     # æ—¥æœŸæ ¼å¼åŒ–
  go_router: ^*     # è·¯ç”±å¯¼èˆª
```

### APIè°ƒç”¨

æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨Modelå‚æ•°ï¼Œéµå¾ªé¡¹ç›®è§„èŒƒï¼š

```dart
// âœ… æ­£ç¡®
final result = await
_restClient.fallback
    .getUserBoughtApiV2LowAdminApiUserBoughtGet
(
limit: _pageLimit,
offset: _offset,
userId: widget.
userId
,
);

// ğŸš« é”™è¯¯
// response = await dio.get('/api/v2/low_admin_api/user_bought?userId=123');
```

### åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ å¯¼å‡ºåŠŸèƒ½**
    - å¯ä»¥æ·»åŠ å¯¼å‡ºä¸ºCSV/Excelçš„åŠŸèƒ½
    - åœ¨ç»„ä»¶ä¸­æ·»åŠ å¯é€‰çš„å¯¼å‡ºå›è°ƒ

2. **æ·»åŠ æ›´å¤šè¿‡æ»¤é€‰é¡¹**
    - æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
    - æŒ‰å•†å“åç§°ç­›é€‰
    - æŒ‰è¿‡æœŸçŠ¶æ€ç­›é€‰

3. **æ€§èƒ½ä¼˜åŒ–**
    - å¯ä»¥è€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨
    - æ·»åŠ ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è¯·æ±‚

4. **æ‰¹é‡æ“ä½œ**
    - æ·»åŠ å¤šé€‰åŠŸèƒ½
    - æ‰¹é‡åˆ é™¤è®°å½•

### æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**
    - âœ… åˆ—è¡¨æ­£å¸¸åŠ è½½
    - âœ… åˆ†é¡µåŠ è½½å·¥ä½œæ­£å¸¸
    - âœ… ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½
    - âœ… ç¼–è¾‘è®°å½•åŠŸèƒ½
    - âœ… åˆ é™¤è®°å½•åŠŸèƒ½
    - âœ… ç”¨æˆ·IDå¯¼èˆªåŠŸèƒ½
    - âœ… æœç´¢è¿‡æ»¤åŠŸèƒ½

2. **è¾¹ç•Œæµ‹è¯•**
    - ç©ºåˆ—è¡¨çŠ¶æ€
    - ç½‘ç»œé”™è¯¯å¤„ç†
    - æ— æ•ˆç”¨æˆ·ID
    - æ—¶åŒºè¾¹ç•Œæƒ…å†µ

### æ€»ç»“

é€šè¿‡ç»„ä»¶åŒ–é‡æ„ï¼š

- **å‡å°‘äº†ä»£ç é‡å¤**ï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬
- **æé«˜äº†ä»£ç å¤ç”¨æ€§**ï¼Œæ–¹ä¾¿æœªæ¥æ‰©å±•
- **ä¿æŒäº†åŠŸèƒ½å®Œæ•´æ€§**ï¼Œæ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½
- **éµå¾ªäº†é¡¹ç›®è§„èŒƒ**ï¼Œç¬¦åˆç¼–ç æŒ‡å—
- **ä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒ**ï¼Œæ·»åŠ äº†ä¸‹æ‹‰åˆ·æ–°ç­‰åŠŸèƒ½

